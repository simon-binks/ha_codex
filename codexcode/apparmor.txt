#include <tunables/global>

profile codexcode flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>

  # Capabilities needed for terminal and networking
  capability net_admin,
  capability net_raw,
  capability setgid,
  capability setuid,
  capability chown,
  capability fowner,
  capability dac_override,
  capability dac_read_search,
  capability sys_tty_config,

  # Network access for OpenAI/Codex API and hass-mcp
  network,

  # PTY/TTY access for terminal
  /dev/ptmx rw,
  /dev/pts/* rw,
  /dev/tty* rw,
  /dev/null rw,
  /dev/zero r,
  /dev/urandom r,

  # System files (read-only)
  /etc/** r,
  /usr/** r,
  /lib/** r,
  /proc/** r,
  /sys/** r,

  # Execute permissions for binaries
  /bin/** ixr,
  /usr/bin/** ixr,
  /usr/lib/** ixmr,
  /usr/local/** ixr,
  /usr/libexec/** ixr,

  # Add-on data
  /data/** rwk,

  # Home Assistant config - main working directory
  /homeassistant/ r,
  /homeassistant/** rwk,

  # Other mapped HA directories
  /ssl/ r,
  /ssl/** r,
  /share/ r,
  /share/** rwk,
  /media/ r,
  /media/** rwk,
  /backup/ r,
  /backup/** r,
  /addon_configs/ r,
  /addon_configs/** rwk,
  /config/ r,
  /config/** rwk,

  # Codex tooling and user home
  /root/ r,
  /root/** rwk,
  /root/.local/** ixr,
  /tmp/** rwk,

  # Node.js modules
  /usr/lib/node_modules/** ixmr,
}
